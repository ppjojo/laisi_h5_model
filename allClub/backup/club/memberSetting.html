<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
		<title>俱乐部设置</title>
		<!-- 引入样式文件 -->
		<link rel="stylesheet" href="../../common/css/vant-rem.css">
		<link rel="stylesheet" type="text/css" href="css/memberSetting.css" />
		<link rel="stylesheet" type="text/css" href="css/iosTop.css" />
		<script type="text/javascript">
			document.documentElement.style.fontSize = document.documentElement.clientWidth / 7.5 + 'px';
		</script>
		<style type="text/css">
			.van-nav-bar .van-icon{
				color: #1F1F1F;
			}
			.smallpic {
				width: .72rem;
				height: .72rem;
				border-radius: .1rem;
				vertical-align: middle;
			}
			
			.van-uploader__preview,
			.van-uploader__preview-image {
				width: .72rem;
				height: .72rem;
				border-radius: .1rem;
				vertical-align: middle;
				margin-top: .1rem;
				/* display: none; */
			}
			.contentSpan{
				font-size: 0.28rem;
				float: right;
			}
			[class*=van-hairline]::after{
				border:none;
			}
			.listBox{
				padding: .08rem .3rem;
				border-bottom: .02rem solid #EBEDF0;
			}
		</style>

	</head>
	<body>
		<div id="app" class="page" v-cloak>
			<div class="header">
				<van-nav-bar title="俱乐部设置"
				 @click-left="OnclickLeft"
				 left-arrow>
				</van-nav-bar>
			</div>
			<div style="padding-top: 0.92rem;">
				<div class="detailBox">
					<div class="listBox">
						<span>俱乐部名称</span>
						<span class="contentSpan">
							{{submitform.name}}
						</span>
					</div>
					<div class="listBox ub ub-ac ub-pj" >
						<span>俱乐部形象</span>
						<img class="smallpic" :src="submitform.photo" />
					</div>
					<div class="listBox ub ub-ac ub-pj" @click="localStorage.setItem('clubForm', JSON.stringify(submitform));window.location.href='memberSettingSecond.html'">
						<span style="display: block;">俱乐部简介</span>
						<van-icon style="display: block;" color="#969799" name="arrow" />
					</div>
					<div class="listBox" style="border-bottom: .2rem solid #f8f8f8;">
						<span>所在城市</span>
						<span class="contentSpan">
							{{(submitform.province||"")+(submitform.city||"")+(submitform.county||"")}}
						</span>
					</div>
				
				<div class="listBox ub ub-ac ub-pj" @click="gotomemberList"  style="border-bottom: .2rem solid #f8f8f8;">
					<span>成员</span>
					<div class="ub ub-ac">
						<div style="font-size: 0.24rem;color: #000;">{{submitform.memberNumber?submitform.memberNumber+'人':''}}</div>
						<van-icon style="display: block;" color="#969799" name="arrow" />
					</div>
				</div>
				<div class="listBox ub ub-ac ub-pj" @click="historyList" >
					<span style="display: block;">参与历史</span>
					<van-icon style="display: block;" color="#969799" name="arrow" />
				</div>
				</div>
				<div class="outClub" @click="quitClubReady">退出俱乐部</div>
			</div>
		</div>
	</body>
	<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/vant@2.9/lib/vant.min.js"></script>
	<script src="js/area.js"></script>
	 
	<script src="../../common/js/network.js"></script>
	<script type="text/javascript">
		new Vue({
			el: '#app',
			data() {
				return {
					submitform: {},
					clubId: ""
				};
			},
			created() {
				this.clubId = getQueryString("id");
				this.initData();
			},
			methods: {
				OnclickLeft(){
					Interaction.closePage();
				},
				initData() {
					var _self = this;
					ajax({
						type: "get",
						url: "club/clubDetail",
						data: {
							clubId: _self.clubId
						},
						success: function(res) {
							if (res.code == 0) {
								_self.submitform = res.data;
							} else {
								_self.$toast(res.msg);
							}
						},
						error: function() {
							console.log("error")
						}
					})
				},
				//进入成员管理传入不同的参数
				gotomemberList(flag) {
					window.location.href = "memberList.html?flag=5&id=" + this.clubId
				},
				//参与历史
				historyList() {
					window.location.href = "historyList.html?id=" + this.clubId + "&userId=" + JSON.parse(localStorage.getItem("appInfo")).userId;
					// return;
					// var str = "h5/h5V2/allClub/club/historyList.html?id=" + this.clubId + "&userId=" + JSON.parse(localStorage.getItem("appInfo")).userId;
					// if (isIOS) {
					// 	var allstr = "/" + str
					// 	Interaction.pushToNextVC(allstr)
					// } else {
					// 	window.location.href = "historyList.html?id=" + this.clubId + "&userId=" + JSON.parse(localStorage.getItem("appInfo")).userId;
					// }
					
				},
				quitClubReady(){
					var _self=this;
					this.$dialog.confirm({
					  // title: '标题',
					  message: '您确定要退出俱乐部吗？'
					}).then(() => {
					  _self.quitClub();
					}).catch(() => {
					  
					});
				},
				//成员退出俱乐部
				quitClub() {
					var _self = this;
					ajax({
						type: "post",
						url: "club/quitClub",
						data: {
							clubId: _self.clubId,
							memberId: JSON.parse(localStorage.getItem("appInfo")).userId
						},
						success: function(res) {
							if (res.code == 0) {
								_self.$toast("成功退出俱乐部!");
								setTimeout(function() {
									_self.refreshClubList();
								}, 500)
							} else {
								_self.$toast(res.msg);
							}
						},
						error: function() {
							console.log("error")
						}
					})
				},
				//退出俱乐部成功之后告诉原生刷新列表页面 
				refreshClubList() {
					if (/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)) { //判断iPhone|iPad|iPod|iOS
						try {
							window.webkit.messageHandlers.lstNative.postMessage({
								'method': 'quitClubSuccess'
							})
						} catch (err) {
							console.log('window.webkit.messageHandlers failed')
						}

					} else if (/(Android)/i.test(navigator.userAgent)) { //判断Android
						window.android.quitClubSuccess();
					}
				}
			}
		})
	</script>
</html>
