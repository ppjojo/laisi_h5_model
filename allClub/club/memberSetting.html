<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
    <title>俱乐部设置</title>
    <!-- 引入样式文件 -->
    <link rel="stylesheet" href="https://oss.laisitech.com/ccd1029d-8dd1-442a-94a7-5205ee2ff9f5.css">

    <link rel="stylesheet" href="../font/iconfont.css">
    <link rel="stylesheet" type="text/css" href="../clubList_Detail/css/header.css" />

    <link rel="stylesheet" type="text/css" href="css/memberSetting.css" />
    <link rel="stylesheet" id="themeCssLink2" href="../../common/css/theme_black.css">

    <style type="text/css">
        .van-nav-bar .van-icon {
            color: #1F1F1F;
        }
        
        .smallpic {
            width: .72rem;
            height: .72rem;
            border-radius: .1rem;
            vertical-align: middle;
        }
        
        .van-uploader__preview,
        .van-uploader__preview-image {
            width: .72rem;
            height: .72rem;
            border-radius: .1rem;
            vertical-align: middle;
            margin-top: .1rem;
            /* display: none; */
        }
        
        [class*=van-hairline]::after {
            border: none;
        }
        
        .listBox {
            padding: .08rem .3rem;
            /* border-bottom: .02rem solid #EBEDF0; */
        }
        
        #app>.header,
        .van-nav-bar,
        .monkey-pull-refresh,
        .DBnotice {
            background-color: var(--bgColor);
        }
        
        .van-nav-bar .van-icon,
        .van-nav-bar__title,
        .van-list__error-text,
        .van-list__finished-text,
        .van-list__loading {
            color: var(--textColor);
        }
    </style>

</head>

<body>
    <div id="app" class="normalHeader" v-cloak>
        <div class="header">
            <van-nav-bar @click-left="onclickLeft" title="俱乐部设置" left-arrow safe-area-inset-top fixed>
                <template #left>
					<span class="icon iconfont icon-fanhuianniu" style="font-size: 0.5rem;" />
				</template>
            </van-nav-bar>
        </div>
        <div>
            <div class="detailBox">
                <div class="listBox">
                    <div>俱乐部名称</div>
                    <div class="rightBox">
                        {{submitform.name}}
                    </div>
                </div>
                <div class="listBox ">
                    <div>俱乐部形象</div>
                    <img class="smallpic" :src="submitform.photo" />
                </div>
                <div class="listBox " @click="localStorage.setItem('clubForm', JSON.stringify(submitform));window.location.href='memberSettingSecond.html'">
                    <span style="display: block;">俱乐部简介</span>
                    <van-icon style="display: block;" color="#969799" name="arrow" />
                </div>
                <div class="listBox" style="border-bottom: .08rem solid var(--borderColor);">
                    <span>所在城市</span>
                    <span class="rightBox">
						{{(submitform.province||"")+(submitform.city||"")+(submitform.county||"")}}
					</span>
                </div>
                <div class="listBox " @click="gotoNickName" v-if="submitform.type=='05'" style="border-bottom: .08rem solid var(--borderColor);">
                    <span>我在俱乐部的昵称</span>
                    <div class="ub ub-ac">
                        <div style="font-size: 0.28rem;color: var(--textColor);">{{submitform.nickname}}</div>
                        <van-icon style="display: block;" color="#969799" name="arrow" />
                    </div>
                </div>
                <div class="listBox " @click="gotomemberList" style="border-bottom: .08rem solid var(--borderColor);">
                    <span>成员列表</span>
                    <div class="ub ub-ac">
                        <div style="font-size: 0.24rem;">
                            {{submitform.memberNumber?submitform.memberNumber+'人':''}}</div>
                        <van-icon style="display: block;" color="#969799" name="arrow" />
                    </div>
                </div>
                <div class="listBox" @click="historyList">
                    <span style="display: block;">我的参与</span>
                    <van-icon style="display: block;" color="#969799" name="arrow" />
                </div>
            </div>
            <div class="outClub" @click="quitClubReady">退出俱乐部</div>
        </div>
    </div>
</body>
<script src="https://oss.laisitech.com/4749d39a-e8e9-46e4-b75a-8dcdb248c9c9.js?name=vue"></script>
<script src="https://oss.laisitech.com/50c1bcb1-6c6d-4389-bee5-7778b6613ed9.js?name=vant"></script>
<script src="js/area.js"></script>
<script src="../../common/js/network.js"></script>
<script type="text/javascript">
    new Vue({
        el: '#app',
        data() {
            return {
                submitform: {},
                clubId: ""
            };
        },
        created() {
            window.initData = this.initData;
            this.clubId = getQueryString("id") || 10000219;
            this.initData();
        },
        methods: {
            onclickLeft() {
                window.history.back(-1)
            },
            initData() {
                var _self = this;
                ajax({
                    type: "get",
                    url: "club/clubDetail",
                    data: {
                        clubId: _self.clubId
                    },
                    success: function(res) {
                        if (res.code == 0) {
                            _self.submitform = res.data;
                        } else {
                            _self.$toast(res.msg);
                        }
                    },
                    error: function() {
                        console.log("error")
                    }
                })
            },
            //进入成员管理传入不同的参数
            gotomemberList(flag) {
                if (this.submitform.type == '05') {
                    window.location.href = "../corporateClub/groupMember.html?clubId=" + this.clubId +
                        "&fromchoose=1" + "&clubGroupId=" + this.submitform.self.clubGroupId;
                } else {
                    window.location.href = "memberList.html?flag=5&id=" + this.clubId
                }
            },
            gotoNickName() { //修改昵称
                window.location.href = "../corporateClub/changeNickname.html?name=" + this.submitform.nickname +
                    "&id=" + this.clubId
            },
            //参与历史
            historyList() {
                window.location.href = "../corporateClub/myJoin.html?id=" + this.clubId
                    // return
                    // if (this.submitform.type == '05') {
                    //     window.location.href = "../corporateClub/myJoin.html?id=" + this.clubId
                    // } else {
                    //     window.location.href = "historyList.html?id=" + this.clubId
                    // }

            },
            quitClubReady() {
                var _self = this;
                this.$dialog.confirm({
                    // title: '标题',
                    message: '您确定要退出俱乐部吗？'
                }).then(() => {
                    _self.quitClub();
                }).catch(() => {

                });
            },
            //成员退出俱乐部
            quitClub() {
                var _self = this;
                ajax({
                    type: "post",
                    url: "club/quitClub",
                    data: {
                        clubId: _self.clubId,
                        memberId: JSON.parse(localStorage.getItem("appInfo")).userId
                    },
                    success: function(res) {
                        if (res.code == 0) {
                            _self.$toast("成功退出俱乐部!");

                            setTimeout(function() {
                                if (getQueryString('fromH5') == 1) {
                                    window.history.go(-2)
                                } else {
                                    Interaction.closePage();
                                }
                            }, 500)
                        } else {
                            _self.$toast(res.msg);
                        }
                    },
                    error: function() {
                        console.log("error")
                    }
                })
            },
            //退出俱乐部成功之后告诉原生刷新列表页面 
            refreshClubList() {
                if (isIOS) { //判断iPhone|iPad|iPod|iOS
                    window.webkit.messageHandlers.lstNative.postMessage({
                        'method': 'quitClubSuccess'
                    })
                } else { //判断Android
                    window.android.quitClubSuccess();
                }
            }

        }
    })
</script>

</html>