<!DOCTYPE html>
<html lang="zh-cmn-Hans">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
    <title>奖品详情</title>
    <!-- 引入样式文件 -->
    <link rel="stylesheet" href="https://oss.laisitech.com/ccd1029d-8dd1-442a-94a7-5205ee2ff9f5.css">
    <link rel="stylesheet" href="../common/css/basic.css">
    <link rel="stylesheet" href="css/prizedetail.css">
    <link rel="stylesheet" href="css/font/iconfont.css">
    <link rel="stylesheet" id="themeCssLink" href="../common/css/theme_black.css">
    <link rel="stylesheet" href="css/pointsLottery.css">
</head>

<body>
    <div id="app" v-cloak>
        <van-loading type="spinner" vertical v-show="submitflag"></van-loading>
        <div class="header">
            <van-nav-bar :title="datalist.name" @click-left="OnclickLeft" safe-area-inset-top fixed>
                <template #left>
						<span class="icon iconfont icon-fanhuianniu" style="font-size: 0.5rem;" />
					</template>
            </van-nav-bar>
        </div>
        <div class="bigpic ub ub-ac ub-pc">
            <img :src="datalist.logo" alt="">
        </div>
        <div class="detailbox">
            <div class="van-multi-ellipsis--l2 title">
                {{datalist.name}}
            </div>
            <div class="ub ub-aend ub-pj">
                <div class="pricetag">
                    {{datalist.integral}}<span>逗币</span>
                </div>
                <div class="changedetail">
                    近30天已兑换{{datalist.exchangedCount||0}}份
                </div>
            </div>
            <div class="describle">
                <span style="font-weight: bold;">奖品说明:</span>
                <div class="detail">
                    {{datalist.instructions||""}}
                </div>
            </div>
        </div>
        <!-- {{ coinnum<datalist.integral?'积分不足':leftcount<=0?'补货中':'立即兑换'}} -->
        <div class="bottombox">
            <div class="bottomBtn" :class="{bottomBtngrey:coinnum<datalist.integral||leftcount<=0}" @click="exchange(coinnum<datalist.integral||leftcount<=0)">
                {{textstr}}
            </div>
        </div>
    </div>
</body>
<script src="https://lsprod3.laisitech.com/h5/h5V3/common/js/vue.js"></script>
<script src="https://lsprod3.laisitech.com/h5/h5V3/common/js/vant.js"></script>
<script src="../common/js/network.js"></script>
<script src="js/tool.js"></script>
<script>
    new Vue({
        el: '#app',
        data() {
            return {
                pid: getQueryString("id"),
                leftcount: parseInt(getQueryString("leftcount")),
                coinnum: 0,
                datalist: {},
                textstr: "",
                submitflag: false,

            }
        },
        filters: {},
        mounted() {

        },
        created() {
            this.mycoinnum();
            // this.getawardinfo();
        },
        methods: {
            mycoinnum() {
                var _self = this;
                ajax({
                    type: "get",
                    url: "integral/my/coins",
                    data: {},
                    success: function(res) {
                        if (res.code == 0) {
                            _self.coinnum = res.data || 0;
                            _self.getawardinfo();
                        } else {
                            _self.$toast(res.msg);
                        }
                    },
                    error: function() {
                        console.log("error")
                    }
                })
            },
            getawardinfo() {
                var _self = this;
                ajax({
                    type: "get",
                    url: "activity/exchange/show/awardDetail",
                    data: {
                        "awardClass": _self.pid
                    },
                    success: function(res) {
                        if (res.code == 0) {
                            _self.datalist = res.data;
                            _self.textstr = _self.coinnum < _self.datalist.integral ? '积分不足' : _self.leftcount <= 0 ? '补货中' : '立即兑换'
                        } else {
                            _self.$toast(res.msg);
                        }
                    },
                    error: function() {
                        console.log("error")
                    }
                })
            },
            exchange(flag) {
                if (flag) return;
                if (!this.datalist.logo && !this.datalist.integral) return;
                if (this.submitflag) return;
                this.submitflag = true;
                var _self = this;
                ajax({
                    type: "post",
                    url: "activity/exchange/award",
                    data: {
                        "awardClass": _self.datalist.awardClass
                    },
                    success: function(res) {
                        if (res.code == 0) {
                            localStorage.setItem('coinchange', 1);
                            let menuindex = _self.datalist.type == 1 ? 0 : _self.datalist.type == 5 || _self.datalist.type == 4 ? 1 :
                                2;
                            window.location.replace("./orderresult.html?menuindex=" + menuindex + "&fromwhere=2&isSuccess=1");
                        } else if (res.code == 2766 || res.code == 2752 || res.code == 2768 || res.code == 2753) {
                            _self.submitflag = false;
                            _self.$toast(res.msg)
                        } else {
                            _self.submitflag = false;
                            window.location.href = "./orderresult.html?fromwhere=2&isSuccess=2";
                        }
                    },
                    error: function() {
                        _self.submitflag = false;
                        window.location.href = "./orderresult.html?fromwhere=2&isSuccess=2";
                        console.log("error")
                    }
                })
            },
            OnclickLeft() {
                window.history.back(-1);
            }



        }
    })
</script>

</html>